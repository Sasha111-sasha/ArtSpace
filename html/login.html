<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArtSpace | –í—Ö—ñ–¥ —Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
<div class="form-wrapper">
  <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥—É -->
  <div class="login-form" id="login">
    <h2>–í—Ö—ñ–¥</h2>
    <form id="loginForm">
      <label for="login-email">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞:</label>
      <input type="email" id="login-email" placeholder="–í–≤–µ–¥—ñ—Ç—å email" required>

      <label for="login-password">–ü–∞—Ä–æ–ª—å:</label>
      <input type="password" id="login-password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required>

      <button type="submit">–£–≤—ñ–π—Ç–∏</button>
      <p class="toggle">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? <a href="#" onclick="showRegister()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å</a></p>
    </form>
  </div>

  <!-- –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
  <div class="register-form" id="register" style="display:none;">
    <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
    <form id="registerForm">
      <label for="firstName">–Ü–º‚Äô—è:</label>
      <input type="text" id="firstName" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º‚Äô—è" required>

      <label for="lastName">–ü—Ä—ñ–∑–≤–∏—â–µ:</label>
      <input type="text" id="lastName" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ" required>

      <label for="reg-email">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞:</label>
      <input type="email" id="reg-email" placeholder="–í–≤–µ–¥—ñ—Ç—å email" required>

      <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
      <input type="text" id="phone" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω" required>

      <label for="reg-password">–ü–∞—Ä–æ–ª—å:</label>
      <input type="password" id="reg-password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required>

      <label for="confirm-password">–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:</label>
      <input type="password" id="confirm-password" placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required>

      <button type="submit">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
      <p class="toggle">–í–∂–µ –º–∞—î—Ç–µ –∞–∫–∞—É–Ω—Ç? <a href="#" onclick="showLogin()">–£–≤—ñ–π–¥—ñ—Ç—å</a></p>
    </form>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');

  // üîπ –ü–æ–∫–∞–∑–∞—Ç–∏ —Ñ–æ—Ä–º—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
  function showRegister() {
    document.getElementById('login').style.display = 'none';
    document.getElementById('register').style.display = 'block';
  }

  // üîπ –ü–æ–∫–∞–∑–∞—Ç–∏ —Ñ–æ—Ä–º—É –ª–æ–≥—ñ–Ω—É
  function showLogin() {
    document.getElementById('register').style.display = 'none';
    document.getElementById('login').style.display = 'block';
  }

  // üîπ –í–∞–ª—ñ–¥–∞—Ü—ñ—è —ñ–º–µ–Ω—ñ
  function validateName(name) {
    return /^[A-Za-z–ê-–Ø–∞-—è–Å—ë–á—ó–Ü—ñ–Ñ—î“ê“ë\s'-]{2,}$/.test(name);
  }

  // üîπ –í–∞–ª—ñ–¥–∞—Ü—ñ—è email
  function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  // üîπ –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
  function validatePhone(phone) {
    return /^(\+380\d{9}|\d{10})$/.test(phone);
  }

  // üîπ –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π API-–∑–∞–ø–∏—Ç
  async function apiRequest(url, options = {}) {
    const config = {
      headers: { 'Content-Type': 'application/json', ...(options.headers || {}) },
      ...options
    };
    const res = await fetch(url, config);
    let json = {};
    try { json = await res.json(); } catch {}
    if (!res.ok) throw new Error(json.message || `HTTP ${res.status}`);
    return json;
  }

  // ==============================
  // üîπ –õ–û–ì–Ü–ù
  // ==============================
  loginForm.addEventListener('submit', async e => {
    e.preventDefault(); // ‚ùå –±–ª–æ–∫—É—î–º–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;

    if (!email || !password) {
      alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å email —Ç–∞ –ø–∞—Ä–æ–ª—å');
      return;
    }

    if (!validateEmail(email)) {
      alert('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email');
      return;
    }

    try {
      const data = await apiRequest('/api/login', { method: 'POST', body: JSON.stringify({ email, password }) });

      if (data.success) {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–æ–∫–µ–Ω —ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        localStorage.setItem('artspace_token', data.token);
        localStorage.setItem('artspace_user', JSON.stringify(data.user));

        // –†–µ–¥–∏—Ä–µ–∫—Ç –∑–∞ —Ä–æ–ª–ª—é
        const rolePaths = {
          1: '/html/user.html',
          2: '/html/content-manager.html',
          3: '/html/manager.html',
          4: '/html/admin.html'
        };
        window.location.href = rolePaths[data.user.roleId] || '/index.html';
      } else {
        alert(data.message || '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å');
      }
    } catch (err) {
      alert(err.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥—ñ');
    }
  });

  // ==============================
  // üîπ –†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø
  // ==============================
  registerForm.addEventListener('submit', async e => {
    e.preventDefault();
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const password = document.getElementById('reg-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;

    // üîπ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–ª—ñ–≤
    if (!validateName(firstName)) { alert('–î–æ–∑–≤–æ–ª–µ–Ω—ñ –ª–∏—à–µ –ª—ñ—Ç–µ—Ä–∏, –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –¥–µ—Ñ—ñ—Å–∏'); return; }
    if (!validateName(lastName)) { alert('–î–æ–∑–≤–æ–ª–µ–Ω—ñ –ª–∏—à–µ –ª—ñ—Ç–µ—Ä–∏, –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –¥–µ—Ñ—ñ—Å–∏'); return; }
    if (!validateEmail(email)) { alert('–ù–µ–≤—ñ—Ä–Ω–∏–π email'); return; }
    if (phone && !validatePhone(phone)) { alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É. –í–≤–µ–¥—ñ—Ç—å +380XXXXXXXXX –∞–±–æ 10 —Ü–∏—Ñ—Ä'); return; }
    if (!password || password.length < 6 || password.length > 12) { alert('–ü–∞—Ä–æ–ª—å –º–∞—î –±—É—Ç–∏ 6-12 —Å–∏–º–≤–æ–ª—ñ–≤'); return; }
    if (password !== confirmPassword) { alert('–ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å'); return; }

    try {
      const data = await apiRequest('/api/register', {
        method: 'POST',
        body: JSON.stringify({ firstName, lastName, email, phone, password, confirmPassword })
      });

      if (data.success) {
        alert('–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –£–≤—ñ–π–¥—ñ—Ç—å.');
        showLogin();
        document.getElementById('login-email').value = email;
        document.getElementById('login-email').focus();
      } else {
        alert(data.message || '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó');
      }
    } catch (err) {
      alert(err.message || '–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ');
    }
  });

  // üîπ –í—ñ–∫–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–æ
  window.showLogin = showLogin;
  window.showRegister = showRegister;
});
</script>


</body>
</html>
